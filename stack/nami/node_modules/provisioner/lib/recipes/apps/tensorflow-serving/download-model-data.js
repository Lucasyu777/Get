/// <reference path="../../../../typings-recipe.d.ts" />
/*
 * Download ResNet model data
 */
"use strict";
recipes.register({
    id: "download-model-data",
    on: { beforeInitialize: {} },
    conditions: {
        tierModules: { any: ["tensorflow-serving"] },
        platformTags: { any: ["linux"] }
    },
    recipeHandler: function (input) {
        logger.info("Downloading model...");
        const resnetModelTarballName = "resnet_v2_fp32_savedmodel_NHWC_jpg.tar.gz";
        runProgram("wget", [`http://download.tensorflow.org/models/official/20181001_resnet/savedmodels/${resnetModelTarballName}`], { cwd: "/tmp/" });
        logger.info("Data model successfully downloaded. Extracting...");
        fs.mkdirSync("/opt/bitnami/model-data", { recursive: true });
        runProgram("tar", [
            "-xzf",
            "resnet_v2_fp32_savedmodel_NHWC_jpg.tar.gz",
            "-C",
            "/opt/bitnami/model-data",
            "--strip-components=2"
        ], { cwd: "/tmp/" });
    }
});
